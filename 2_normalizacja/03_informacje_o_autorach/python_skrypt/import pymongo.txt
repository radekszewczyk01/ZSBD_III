import pymongo

# KONFIGURACJA
MONGO_URI = "mongodb://localhost:27017/"
DB_NAME = "retractionWatchDB"
COL_NAME = "articles"

def find_first_orcid():
    client = pymongo.MongoClient(MONGO_URI)
    db = client[DB_NAME]
    collection = db[COL_NAME]

    print("üîç Przeszukujƒô pobrane dane w poszukiwaniu ORCID...")

    # Szukamy tylko w dokumentach, kt√≥re majƒÖ pobrane dane zewnƒôtrzne (crossref_data)
    # To optymalizacja, ≈ºeby nie mieli≈Ço pustych rekord√≥w
    cursor = collection.find({ 
        "crossref_data": { "$exists": True, "$ne": [] } 
    })

    found_orcid = False
    i = 0
    for doc in cursor:
        i += 1
        # Pobierz tablicƒô autor√≥w z Crossref
        authors_list = doc.get("crossref_data", [])
        
        for author in authors_list:
            # Sprawd≈∫, czy ten konkretny autor ma klucz 'ORCID'
            if "ORCID" in author:
                print("\n" + "="*40)
                print("‚úÖ SUKCES! ZNALEZIONO AUTORA Z ORCID")
                print("="*40)
                print(f"Tytu≈Ç artyku≈Çu: {doc.get('Title', 'Brak tytu≈Çu')}")
                print(f"DOI artyku≈Çu:   {doc.get('OriginalPaperDOI', 'Brak DOI')}")
                print("-" * 20)
                print("PE≈ÅNE DANE AUTORA Z API:")
                print(author)
                print("="*40)
                
                # Ustawiamy flagƒô i przerywamy wewnƒôtrznƒÖ pƒôtlƒô
                found_orcid = True
                break
        
        # Je≈õli znaleziono, przerywamy te≈º g≈Ç√≥wnƒÖ pƒôtlƒô (szukamy tylko pierwszego)
        if found_orcid:
            break

    if not found_orcid:
        print(i)
        print("\n‚ùå Przeszukano dostƒôpne dane z Crossref, ale nie znaleziono ≈ºadnego pola 'ORCID'.")
        print("Mo≈ºliwe przyczyny:")
        print("1. Skrypt pobierajƒÖcy dane jeszcze nie trafi≈Ç na 'bogaty' artyku≈Ç.")
        print("2. W pobranych artyku≈Çach wydawcy nie udostƒôpnili ORCID.")

if __name__ == "__main__":
    find_first_orcid()