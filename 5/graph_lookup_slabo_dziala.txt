var targetAuthor = "Joachim Boldt"; // Nasz "Pacjent Zero"

db.collaborations.aggregate([
  // 1. Punkt startowy: Zaczynamy od wpisów, gdzie głównym autorem jest Boldt
  { $match: { author: targetAuthor } },
  
  // Deduplikacja na starcie (żeby nie startować 50 razy od tego samego)
  { $group: { _id: "$author" } },

  // 2. MAGIA GRAFÓW
  {
    $graphLookup: {
      from: "collaborations",       // Szukamy w tej samej kolekcji
      startWith: "$_id",            // Zaczynamy od Joachima
      connectFromField: "collaborator", // Idziemy do jego współpracownika...
      connectToField: "author",     // ...i szukamy, gdzie ten współpracownik jest autorem
      maxDepth: 1,                  // Głębokość (0 = bezpośredni, 1 = znajomi znajomych)
      depthField: "level",          // Zapisz, jak daleko są od Joachima
      as: "network"                 // Wynik zapisz w tablicy 'network'
    }
  },

  // 3. Obróbka wyników (żeby było czytelnie)
  {
    $project: {
      root_suspect: "$_id",
      network_size: { $size: "$network" }, // Ile osób jest w sieci
      connections: {
        $map: {
          input: "$network",
          as: "n",
          in: {
            name: "$$n.collaborator",
            distance: "$$n.level" // 0 = bezpośredni, 1 = pośredni
          }
        }
      }
    }
  }
])